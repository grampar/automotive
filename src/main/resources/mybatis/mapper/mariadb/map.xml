<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="map">
    
    <select id="getSiGunGuList" resultType="kr.co.n3n.smartcity.model.CommMap">
    <![CDATA[        
		SELECT 
			SUBSTR(CODE,1,5) AS CODE , REPLACE(NAME ,(SELECT NAME FROM LAW_CODE WHERE SUBSTR(CODE ,1,2) = #{sidoCode} AND SUBSTR(CODE,3,8)  = '00000000') ,'') AS NAME 
		FROM LAW_CODE
		WHERE SUBSTR(CODE ,1,2) = #{sidoCode} AND SUBSTR(CODE,6,5) = '00000' AND SUBSTR(CODE,3,8)  <> '00000000'
		ORDER BY NAME 
	]]>	
    </select>
    
    <select id="getDongList" resultType="kr.co.n3n.smartcity.model.CommMap">  
    <![CDATA[        
		SELECT 
			CODE , REPLACE(NAME ,(SELECT NAME FROM LAW_CODE WHERE SUBSTR(CODE,1,5) = #{siGunGuCode} AND SUBSTR(CODE,6,5) = '00000' LIMIT 1) ,'') AS NAME 
		FROM LAW_CODE
		WHERE SUBSTR(CODE,1,5) = #{siGunGuCode}  AND SUBSTR(CODE,6,5) <> '00000' AND SUBSTR(CODE,9,2) = '00'
		ORDER BY NAME
	]]>		 
    </select>
    
    <select id="getGuDongList" resultType="kr.co.n3n.smartcity.model.CommMap">  
    <![CDATA[        
		SELECT 
			CODE , REPLACE(NAME ,(SELECT NAME FROM LAW_CODE WHERE SUBSTR(CODE,1,4) = #{siGunGuCode} AND SUBSTR(CODE,6,5) = '00000' LIMIT 1) ,'') AS NAME 
		FROM LAW_CODE
		WHERE SUBSTR(CODE,1,4) = #{siGunGuCode}  AND SUBSTR(CODE,6,5) <> '00000' AND SUBSTR(CODE,9,2) = '00'
		ORDER BY NAME
	]]>		 
    </select>
    
    <select id="getFacGeoList_no_order" resultType="kr.co.n3n.smartcity.model.CommMap">  
    <![CDATA[        
		SELECT 
			FAC.FACILITIES_ID AS FACILITIES_ID ,FAC.FACILITIES_NAME AS FACILITIES_NAME,ST_X(FAC.GEO_POINT) AS GEO_X , ST_Y(FAC.GEO_POINT) AS GEO_Y,CD.ICON AS ICON_URL
			, FAC.ESNTL_IDNTFC_NO AS ESNTL_IDNTFC_NO
			, FAC.EXPRESSION_BREADTH AS WID ,  FAC.EXPRESSION_HEIGHT AS HEI
			, FAC.LOCATION_INFORMATION_X AS LOCATION_INFORMATION_X
			, FAC.LOCATION_INFORMATION_Y AS LOCATION_INFORMATION_Y
			, FAC.FACILITIES_URL AS FACILITIES_URL
			, FAC.DESCRIPTION AS DESCRIPTION
			, FAC.BITRATE AS BITRATE
			, FAC.CODEC AS CODEC
			, FAC.USE_PTZ AS USE_PTZ
			, FAC.PTZ_DRIVER AS PTZ_DRIVER
			, FAC.USE_RDS AS USE_RDS
			, FAC.OBJECT_TYPE AS OBJECT_TYPE
			, FAC.RTSP_ID AS RTSP_ID
			, FAC.RTSP_PW AS RTSP_PW
			, FAC.MEDIA_SERVER AS MEDIA_SERVER
			, FAC.CONNECT_MODE AS CONNECT_MODE
			, FAC.FPS AS FPS
			, FAC.STATUS AS STATUS
		FROM FACILITIES FAC
		INNER JOIN CODE CD
		ON FAC.STATUS = CD.CODE_ID
		WHERE MBRContains( GeomFromText( 'LINESTRING(${bbox})' ), FAC.GEO_POINT)
	]]>		 
    </select>
    
    <select id="getFacGeoList" resultType="kr.co.n3n.smartcity.model.CommMap">  
    <![CDATA[        
		SELECT 
			FAC.FACILITIES_ID AS FACILITIES_ID ,FAC.FACILITIES_NAME AS FACILITIES_NAME,ST_X(FAC.GEO_POINT) AS GEO_X , ST_Y(FAC.GEO_POINT) AS GEO_Y,CD.ICON AS ICON_URL
			, FAC.ESNTL_IDNTFC_NO AS ESNTL_IDNTFC_NO
			, FAC.EXPRESSION_BREADTH AS WID ,  FAC.EXPRESSION_HEIGHT AS HEI
			, FAC.LOCATION_INFORMATION_X AS LOCATION_INFORMATION_X
			, FAC.LOCATION_INFORMATION_Y AS LOCATION_INFORMATION_Y
			, FAC.FACILITIES_URL AS FACILITIES_URL
			, FAC.DESCRIPTION AS DESCRIPTION
			, FAC.BITRATE AS BITRATE
			, FAC.CODEC AS CODEC
			, FAC.USE_PTZ AS USE_PTZ
			, FAC.PTZ_DRIVER AS PTZ_DRIVER
			, FAC.USE_RDS AS USE_RDS
			, FAC.OBJECT_TYPE AS OBJECT_TYPE
			, FAC.RTSP_ID AS RTSP_ID
			, FAC.RTSP_PW AS RTSP_PW
			, FAC.MEDIA_SERVER AS MEDIA_SERVER
			, FAC.CONNECT_MODE AS CONNECT_MODE
			, FAC.FPS AS FPS
			, FAC.STATUS AS STATUS
			, ST_DISTANCE(POINT(#{geo_x}, #{geo_y}), FAC.GEO_POINT) AS DIST
		FROM FACILITIES FAC
		INNER JOIN CODE CD
		ON FAC.STATUS = CD.CODE_ID
		WHERE MBRContains( GeomFromText( 'LINESTRING(${bbox})' ), FAC.GEO_POINT)
		ORDER BY DIST
	]]>		 
    </select>
    
        
</mapper>